// Generated by IcedCoffeeScript 1.2.0s
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S=[].slice;n={Deferrals:function(){function a(a){this.continuation=a;this.count=1;this.ret=null}a.prototype._fulfill=function(){if(!--this.count)return this.continuation(this.ret)};a.prototype.defer=function(a){var b=this;++this.count;return function(){var c,d;c=1<=arguments.length?S.call(arguments,0):[];a!=null&&(d=a.assign_fn)!=null&&d.apply(null,c);return b._fulfill()}};return a}(),findDeferral:function(){return null}};R=function(){};s=null;d=[];g=[];e=[];f=[];z="";x="";A="";K=!1;a="b";c="s";b="t";M=null;L=function(a){var b,c,d,e,f,g;d="";if(a==="")return"";for(e=f=0,g=a.length-1;0<=g?f<=g:f>=g;e=0<=g?++f:--f){b=a.charAt(e);c=a.charCodeAt(e);c>=1488&&c<1536&&(c-=1360);c<256&&(d+=(c+256).toString(16).substr(-2).toUpperCase())}return d};O=function(a){var b,c,d,e,f;c="";if(a==="")return"";for(d=e=0,f=a.length/2-1;0<=f?e<=f:e>=f;d=0<=f?++e:--e){b=a.slice(d*2,d*2+1+1||9e9);b=parseInt(b,16);b>=128&&(b+=1360);c+=String.fromCharCode(b)}return c};l=function(d,e,f){return f?"!z="+a+":"+L(d)+"_"+c+":"+f:"!z="+a+":"+L(d)+"_"+b+":"+L(e)};m=function(a){return"http://"+window.location.host+"/#"+l(z,"",a)};P=function(a){var b,c,d,e=this;d=R;b=n.findDeferral(arguments);(function(a){c=new n.Deferrals(a,{parent:b,filename:"gov-watch.iced",funcname:"update_history"});setTimeout(c.defer({assign_fn:function(){return function(){return c.ret=arguments[0]}}(),lineno:57}),0);c._fulfill()})(function(){return window.location.hash=l(z,x,a)})};B=function(a){return $("title").html(a)};t=function(){var e,f,g,h,i,j,l,m,n,o;e=window.location.hash;f=e.slice(4,e.length);j=f.split("_");i=null;z=null;x="";for(m=0,n=j.length;m<n;m++){h=j[m];o=h.split(":"),g=o[0],l=o[1];g===a&&(z=O(l));g===c&&(i=l);g===b&&(x=O(l))}if(!z&&!i){z=d[0];P();return}$("#books li.book").toggleClass("active",!1);$("#books li.book[data-book='"+z+"']").toggleClass("active",!0);if(x!==""){J(!1);$("#searchbox").val(x)}if(i){A=i;y(A);$(".item").removeClass("shown");$("#items").isotope({filter:".shown"})}else{B('דו"ח טרכטנברג | המפקח: מעקב אחר ישום המלצות הועדה');A=null;y(null);k()}return _gaq.push(["_trackPageview","/"+e])};Q=!1;J=function(a){a?$("#searchbox").val("סינון חופשי של ההמלצות"):Q&&$("#searchbox").val("");Q=a;return $("#searchbox").toggleClass("watermark",a)};h=function(a){var b,c;if(!a)return a;a=a.split(" ");if(a.length>1)b=a[0],c=a[1];else{b=a[0];c=null}b=b.split("/");b=""+b[2]+"/"+b[1]+"/"+b[0];return c?""+b+" "+c:b};i=function(a){var b,c,i,j,k,l,m,n,o,p,q,r,t,u,w,x,y,z,A,B,C,D,E,F,G,H,I;s=a;d={};g={};e={};f={};for(q=0,w=a.length;q<w;q++){k=a[q];j={};d[k.base.book]||(d[k.base.book]={});d[k.base.book][k.base.chapter]=!0;C=k.base.tags;for(r=0,x=C.length;r<x;r++){m=C[r];g[m]=1}((D=k.base.responsible_authority)!=null?D.main:void 0)!=null&&(e[k.base.responsible_authority.main]=1);E=k.base.timeline;for(t=0,y=E.length;t<y;t++){l=E[t];l.israeli_due_date=h(l.due_date)}f[k.base.subject]=1;b=[];p=[];F=k.updates;for(c in F){o=F[c];for(u=0,z=o.length;u<z;u++){n=o[u];n.user=c;n.israeli_update_time=h(n.update_time);c==="gov"?b.push(n):p.push(n);if(n.links){G=n.links;for(B=0,A=G.length;B<A;B++){i=G[B];j[i.url]=!0}}}}k.base.num_links=Object.keys(j).length;k.gov_updates=b;k.watch_updates=p;k.base.subscribers=(H=k.subscribers)!=null?H:0;((I=k.base.recommendation)!=null?I.length:void 0)>500?k.base.recommendation_shortened=k.base.recommendation.slice(0,501)+"&nbsp;"+("<a class='goto-detail' rel='"+k.slug+"' href='#'>")+"עוד..."+"</a>":k.base.recommendation_shortened=k.base.recommendation}g=Object.keys(g);e=Object.keys(e);f=Object.keys(f);d=Object.keys(d);if(localStorage){localStorage.data=JSON.stringify(a);localStorage.all_books=JSON.stringify(d);localStorage.all_tags=JSON.stringify(g);localStorage.all_people=JSON.stringify(e);localStorage.all_subjects=JSON.stringify(f)}return v()};o=!1;D=function(){var a,b,c,d,h,i,j,k,l,m;J(!0);$("#searchbox").change(function(){Q?x="":x=$("#searchbox").val();return P()});$("#searchbox").focus(function(){return J(!1)});$("#searchbox").blur(function(){if($(this).val()==="")return J(!0)});$("#searchbar").submit(function(){return!1});b=[];for(h=0,k=g.length;h<k;h++){d=g[h];b.push({type:"tag",title:d})}for(i=0,l=e.length;i<l;i++){a=e[i];b.push({type:"person",title:a})}for(j=0,m=f.length;j<m;j++){c=f[j];b.push({type:"subject",title:c})}$("#searchbox").typeahead({source:b,items:20,matcher:function(a){return~a.title.indexOf(this.query)},valueof:function(a){return a.title},itemfrom:function(a){return{type:"subject",title:a}},selected:function(a){x=a;return P()},highlighter:function(a){var b;b=a.title.replace(new RegExp("("+this.query+")","ig"),function(a,b){return"<strong>"+b+"</strong>"});return a.type==="subject"?b:a.type==="tag"?"<span class='searchtag'><span>"+b+"</span></span>":a.type==="person"?"<span class='persontag'><span>"+b+"</span></span>":console.log(a.type+" "+a.title)}});return $("#clearsearch").click(function(){x="";J(!0);P();return!1})};w=function(a,b,c){var d;a=$("script[name="+a+"]").html();d=Mustache.to_html(a,b);return $(c).html(d)};j=function(a){var b,c,d,e,f,g;a=a.split("/");g=function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++){b=a[c];e.push(parseInt(b,10))}return e}(),f=g[0],d=g[1],c=g[2];e=function(a){switch(a){case 1:return"ינואר";case 2:return"פברואר";case 3:return"מרץ";case 4:return"אפריל";case 5:return"מאי";case 6:return"יוני";case 7:return"יולי";case 8:return"אוגוסט";case 9:return"ספטמבר";case 10:return"אוקטובר";case 11:return"נובמבר";case 12:return"דצמבר"}};return""+e(d)+" "+f};u=function(a){return a<10?"0"+a:a};N=function(a){switch(a){case"NEW":return"טרם התחיל";case"STUCK":return"תקוע";case"IN_PROGRESS":return"בתהליך";case"FIXED":return"יושם במלואו";case"WORKAROUND":return"יושם חלקית";case"IRRELEVANT":return"יישום ההמלצה כבר לא נדרש"}return""};p=function(a){switch(a){case"NEW":return!1;case"STUCK":return!1;case"IN_PROGRESS":return!0;case"FIXED":return!0;case"WORKAROUND":return!1;case"IRRELEVANT":return!0}return null};I=function(a,b){b==null&&(b=80);return $(a).each(function(){var a,c,d,e,f,g,h,i,k,l,m,n,o,q,r,s,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,M,O,P,Q,R;m=$(this).find(".timeline-logic.horizontal").size()>0;I=new Date;I=""+I.getFullYear()+"/"+u(I.getMonth()+1)+"/"+u(I.getDate()+1);z=0;A=781200;$(this).find(".timeline-logic .timeline-point.today").attr("data-date",I);l=!1;$(this).find(".timeline-logic > ul > li").each(function(){var a,b,c,d,e,f,g,h,i,j,k,m,n,o,p;c=$(this).find(".timeline-point:first").attr("data-date");c=c.split(" ");c.length>1?m=c[1]:m="00:00:00";c=c[0].split("/");m=m.split(":");o=function(){var a,d,e;e=[];for(a=0,d=c.length;a<d;a++){b=c[a];e.push(parseInt(b,10))}return e}(),n=o[0],h=o[1],d=o[2];p=function(){var a,b,c;c=[];for(a=0,b=m.length;a<b;a++){k=m[a];c.push(parseInt(k,10))}return c}(),e=p[0],g=p[1],j=p[2];i=n*372+(h-1)*31+(d-1)+e/24+g/1440+j/86400;if(isNaN(i)||n===1970){i="xxx";l=!0}else{i>z&&(z=i);i<A&&(A=i-1)}$(this).attr("data-date-numeric",i);$(this).find(".timeline-point").attr("data-date-numeric",i);f=$(this).find("img");a=f!=null?f.attr("alt"):void 0;if(a)return f.attr("src","/profile/"+L(a))});if(l){z+=180;$(this).find(".timeline-logic > ul > li[data-date-numeric='xxx']").attr("data-date-numeric",z);$(this).find(".timeline-logic > ul > li[data-date-numeric='xxx']").find(".timeline-point").attr("data-date-numeric",z)}$(this).find(".update-feed > ul > li").tsort({attr:"data-date",order:"desc"});$(this).find(".timeline-logic > ul > li").tsort({attr:"data-date-numeric",order:"desc"});h=$(this).find(".timeline-logic > ul > li > .milestone:first").attr("data-date");h=j(h);$(this).find(".duedate > p").html(h);s=0;q=5;m?C=$(this).innerWidth()-b:C=$(this).innerHeight()-b;c=C;$(this).find(".timeline-logic > ul > li .timeline-point").each(function(){return m?c=c-$(this).outerWidth()-q:c=c-$(this).outerHeight()-q});y=0;k="NEW";e=!1;f=null;w=!1;H=$(this).find(".timeline-logic > ul > li");K=parseInt($(this).find(".timeline-logic > ul > li .today").attr("data-date-numeric"));t=$(this).find(".timeline-logic > ul > li .gov-update:last").attr("data-date-numeric");t?t=parseInt(t):t=A;t&&K&&K-t>180&&(w=!0);a=1e3;v=a;J=a;i=a;for(n=M=P=H.size()-1;P<=0?M<=0:M>=0;n=P<=0?++M:--M){g=$(H[n]);B=g.find(".timeline-point:first");x=g.find(".timeline-line:first");F=(Q=B.attr("data-status"))!=null?Q:k;if(B.hasClass("gov-update")){e=!1;k=F!=null?F:k;v=n;i===a&&(k==="FIXED"||k==="IRRELEVANT")&&(i=n);B.addClass("gov-"+k);p(k)?B.addClass("gov-status-good"):B.addClass("gov-status-bad")}r=!1;if(B.hasClass("today")){J=n;r=!0}if(B.hasClass("watch-update")){if(p(F)!==null){if(p(k)!==p(F)){e=!0;f=F}B.addClass("watch-"+F);p(F)?B.addClass("watch-status-good"):B.addClass("watch-status-bad")}v=n}if(J===a||r){B.find(".implementation-status").addClass("label-"+F);B.find(".implementation-status").html(N(F));x.addClass("status-"+k);e&&B.addClass("conflict")}}for(n=O=R=H.size()-1;R<=0?O<=0:O>=0;n=R<=0?++O:--O){g=$(H[n]);x=g.find(".timeline-line:first");if(i!==a&&n<=i||n<=J)x.addClass("future");else{x.addClass("past");n<=v&&x.addClass("unreported")}}$(this).find(".timeline-logic > ul > li").each(function(){var a,b,d,e;B=$(this).find(".timeline-point:first");x=$(this).find(".timeline-line:first");a=parseInt($(this).attr("data-date-numeric"));d=(z-a)/(z-A);m?e=B.outerWidth()+q:e=B.outerHeight()+q;b=c*(d-s)+e;if(m){$(this).css("width",b);$(this).css("left",y)}else{$(this).css("height",b);$(this).css("top",y)}s=d;return y+=b});$(this).find(".timeline-logic > ul > li:first > .timeline-line").remove();o=k;o!=="FIXED"&&o!=="IRRELEVANT"?w&&(o="STUCK"):w=!1;d=$(this).find(".buxa-header");if(e)d.addClass("conflict");else{d.removeClass("conflict");p(o)?d.addClass("good"):d.addClass("bad")}$(this).attr("data-implementation-status",o);$(this).addClass("implementation-status-"+o);p(o)?$(this).addClass("implementation-status-good"):$(this).addClass("implementation-status-bad");G=function(a){switch(a){case"NEW":return"notstarted";case"STUCK":return"stuck";case"IN_PROGRESS":return"inprogress";case"FIXED":return"done";case"WORKAROUND":return"workaround";case"IRRELEVANT":return"done"}};E=G(o);w&&(E="late");d.before("<div class='stamp "+E+"'></div>");if(e){D=N(f);E=G(f);return d.before("<div class='stamp conflicting "+E+"'></div>")}})};G=function(){var a,b,c,d,e,f,g,h,i;h=$(".item.shown").size();g=$(".item.shown[data-implementation-status='STUCK']").size();f=$(".item.shown[data-implementation-status='NEW']").size();d=$(".item.shown[data-implementation-status='IN_PROGRESS']").size();b=$(".item.shown[data-implementation-status='FIXED']").size();i=$(".item.shown[data-implementation-status='WORKAROUND']").size();e=$(".item.shown[data-implementation-status='IRRELEVANT']").size();a={};h&&(a.total=h);g=f+i+g;g&&(a.stuck=g);c=b+e;c&&(a.implemented=c);d&&(a.in_progress=d);w("summary",a,"#summary");$("#summary .total").click(function(){M=null;k();return!1});$("#summary .stuck").click(function(){M=["STUCK","NEW","WORKAROUND"];k();return!1});$("#summary .implemented").click(function(){M=["FIXED","IRRELEVANT"];k();return!1});return $("#summary .in_progress").click(function(){M=["IN_PROGRESS"];k();return!1})};E=function(){$("#subscribe").modal({show:!1});$("#do_subscribe").click(function(){$("#subscribe_form").submit();return!1});return $("#subscribe_form").submit(function(){var a=this;$.post($(this).attr("action"),{email:$("#subscribe_email").val()},function(b){var c;$("#subscribe").modal("hide");c=$(a).attr("rel");return $(".watch[rel='"+c+"']").html(b)},"json");return!1})};F=function(a){return $(""+a+" .watch").click(function(){var a;a=$(this).attr("rel");$("#subscribe_email").attr("data-slug",a);$("#subscribe_form").attr("action","/subscribe/"+a);$("#subscribe_form").attr("rel",a);$("#subscribe").modal("show");return!1})};H=function(a){return $(a).click(function(){x=$(this).text();J(!1);$("#searchbox").val(x);$("#explanation").modal("hide");P();return!1})};C=function(){return $(".item .goto-detail").click(function(){var a,b,c,d,e;b=$(this).attr("rel");if(!b){e=$(this).parents();for(c=0,d=e.length;c<d;c++){a=e[c];b=$(a).attr("rel");if(b)break}}P(b);return!1})};v=function(){var a,b,c,e,f,g,h,i=this;f=R;c=n.findDeferral(arguments);if(o)return;o=!0;for(g=0,h=d.length;g<h;g++){a=d[g];$("#books").prepend("<li data-book='"+a+"' class='book'><a href='#'>"+a+"</a></li>")}w("item",{items:s},"#items");b=!0;(typeof localStorage!=="undefined"&&localStorage!==null?localStorage.explained:void 0)!=null&&(b=!1);$("#explanation .close").click(function(){typeof localStorage!="undefined"&&localStorage!==null&&(localStorage.explained=!0);$("#explanation").modal("hide");return!1});$("#show-explanation").click(function(){$("#explanation").modal("show");return!1});(function(a){e=new n.Deferrals(a,{parent:c,filename:"gov-watch.iced",funcname:"process_data"});setTimeout(e.defer({assign_fn:function(){return function(){return e.ret=arguments[0]}}(),lineno:675}),50);e._fulfill()})(function(){$.Isotope.prototype._positionAbs=function(a,b){return{right:a,top:b}};$("#items").isotope({itemSelector:".isotope-card",layoutMode:"masonry",transformsEnabled:!1,filter:".shown",getSortData:{followers:function(a){return-parseInt("0"+a.find(".watch").text())},original:function(a){return""+a.attr("data-chapter")+"/{e.attr('data-subchapter')}"},budget:function(a){return-parseInt("0"+a.attr("cost"),10)},comments:function(a){var b;b=-parseInt("0"+a.find(".commentcount").text(),10);return b}}});(function(a){e=new n.Deferrals(a,{parent:c,filename:"gov-watch.iced",funcname:"process_data"});setTimeout(e.defer({assign_fn:function(){return function(){return e.ret=arguments[0]}}(),lineno:697}),50);e._fulfill()})(function(){I(".item");$(".item").css("visibility","inherit");D();E();F(".item");H(".item .tags > ul > li, a[data-tag='true']");C();$("#books li.book a").click(function(){z=$(this).html();P();return!1});$("#sort button").click(function(){var a;$("#sort button").removeClass("active");$(this).addClass("active");a=$(this).attr("value");$("#items").isotope("updateSortData",$(".isotope-card"));$("#items").isotope({sortBy:a});return!1});$("#explanation").modal({show:b});window.onhashchange=t;t();return r(".item")})})};y=function(a){var b,c,d,e,f,g,h,i,j=this;g=R;e=n.findDeferral(arguments);$("fb\\:comments").remove();$("fb\\:like").remove();if(!a){$("#single-item").html("");$("#summary-header").css("visibility","inherit");$("#sort button").removeClass("disabled");$("#searchbox").removeClass("disabled");$("#searchbox").attr("disabled",null);$("#clearsearch").removeClass("disabled");return g($("#clearsearch").attr("disabled",null))}$("#summary-header").css("visibility","hidden");$("#summary").html("");$("#sort button").addClass("disabled");$("#searchbox").addClass("disabled");$("#searchbox").attr("disabled","disabled");$("#clearsearch").addClass("disabled");$("#clearsearch").attr("disabled","disabled");for(h=0,i=s.length;h<i;h++){d=s[h];if(d.slug===a){b=w("single-item",d,"#single-item");B(d.base.book+": "+d.base.subject);c=m(a);$(".detail-view .fb").append("<fb:like href='"+c+"' send='true' width='700' show_faces='true' action='recommend' font='tahoma'></fb:like>");$(".detail-view .fb").append("<fb:comments href='"+c+"' num_posts='2' width='700'></fb:comments>");window.FB&&FB.XFBML.parse(b.get(0),function(){});break}}(function(a){f=new n.Deferrals(a,{parent:e,filename:"gov-watch.iced",funcname:"select_item"});setTimeout(f.defer({assign_fn:function(){return function(){return f.ret=arguments[0]}}(),lineno:762}),50);f._fulfill()})(function(){I(".detail-view",69);F(".detail-view");H(".detail-view .tags > ul > li");r(".detail-view");return g($("html, body").animate({scrollTop:0},0))})};r=function(a){$(""+a+" .commentcount").each(function(){var a,b,c,d,e,f,g=this;f=R;d=n.findDeferral(arguments);c=$(this).attr("rel");(function(a){e=new n.Deferrals(a,{parent:d,filename:"gov-watch.iced"});$.get("https://api.facebook.com/method/fql.query",{query:"SELECT url,commentsbox_count FROM link_stat WHERE url='"+m(c)+"'",format:"json"},e.defer({assign_fn:function(){return function(){return b=arguments[0]}}(),lineno:789}),"json");e._fulfill()})(function(){a=$(g).html();return $(g).html(b[0].commentsbox_count+a)})});if(a===".item")return $("#items").isotope("updateSortData",$(".item"))};k=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;c=RegExp(x,"ig");for(j=0,m=s.length;j<m;j++){d=s[j];f=d.slug;d=d.base;e=x==="";if(x!==""){p=[d.recommendation,d.subject,d.result_metric,d.title,d.chapter,d.subchapter,d.responsible_authority.main,d.responsible_authority.secondary];for(k=0,n=p.length;k<n;k++){i=p[k];i?b=i.indexOf(x)>=0:b=!1;e=e||b}q=d.tags;for(l=0,o=q.length;l<o;l++){h=q[l];h===x&&(e=!0)}}e=e&&(z===""||d.book===z)&&!A;$(".item[rel="+f+"]").toggleClass("shown",e)}G();if(M){a=[function(){var a,b,c;c=[];for(a=0,b=M.length;a<b;a++){g=M[a];c.push(".shown.implementation-status-"+g)}return c}()];a=a.join(",")}else a=".shown";a+=",.always-shown";$("#items").isotope({filter:a});return $("#items").isotope("reLayout")};q=function(){return $.get("/api",i,"json")};$(function(){var a,b,c,h,i,j=this;i=R;c=n.findDeferral(arguments);try{(function(a){h=new n.Deferrals(a,{parent:c,filename:"gov-watch.iced"});$.get("/api/version",h.defer({assign_fn:function(){return function(){return b=arguments[0]}}(),lineno:850}),"json");h._fulfill()})(function(){a=localStorage.version;localStorage.version=JSON.stringify(b);if(a&&b!==JSON.parse(a)){s=JSON.parse(localStorage.data);d=JSON.parse(localStorage.all_books);g=JSON.parse(localStorage.all_tags);e=JSON.parse(localStorage.all_people);f=JSON.parse(localStorage.all_subjects);return v()}return q()})}catch(k){return q()}})}).call(this);