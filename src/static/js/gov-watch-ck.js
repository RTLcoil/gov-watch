// Generated by IcedCoffeeScript 1.2.0i
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X=[].slice;p={Deferrals:function(){function e(e){this.continuation=e;this.count=1;this.ret=null}e.prototype._fulfill=function(){if(!--this.count)return this.continuation(this.ret)};e.prototype.defer=function(e){var t=this;++this.count;return function(){var n,r;n=1<=arguments.length?X.call(arguments,0):[];e!=null&&(r=e.assign_fn)!=null&&r.apply(null,n);return t._fulfill()}};return e}(),findDeferral:function(){return null}};W=function(){};y=null;r=[];o=[];i=[];s=[];N="";x="";C="";j=!1;e="b";n="s";t="t";I=null;F=function(e){var t,n,r,i,s,o;r="";if(e==="")return"";for(i=s=0,o=e.length-1;0<=o?s<=o:s>=o;i=0<=o?++s:--s){t=e.charAt(i);n=e.charCodeAt(i);n>=1488&&n<1536&&(n-=1360);n<256&&(r+=(n+256).toString(16).substr(-2).toUpperCase())}return r};R=function(e){var t,n,r,i,s;n="";if(e==="")return"";for(r=i=0,s=e.length/2-1;0<=s?i<=s:i>=s;r=0<=s?++i:--i){t=e.slice(r*2,r*2+1+1||9e9);t=parseInt(t,16);t>=128&&(t+=1360);n+=String.fromCharCode(t)}return n};c=function(r,i,s){return s?"!z="+e+":"+F(r)+"_"+n+":"+s:"!z="+e+":"+F(r)+"_"+t+":"+F(i)};h=function(e){return"http://"+window.location.host+"/#"+c(N,"",e)};U=function(e){var t,n,r=this;t=p.findDeferral(arguments);(function(e){n=new p.Deferrals(e,{parent:t,filename:"gov-watch.iced",funcname:"update_history"});setTimeout(n.defer({assign_fn:function(){return function(){return n.ret=arguments[0]}}(),lineno:57}),0);n._fulfill()})(function(){return window.location.hash=c(N,x,e)})};k=function(e){return $("title").html(e)};b=function(){var i,s,o,u,a,f,c,h,p,d;i=window.location.hash;s=i.slice(4,i.length);f=s.split("_");a=null;N=null;x="";for(h=0,p=f.length;h<p;h++){u=f[h];d=u.split(":"),o=d[0],c=d[1];o===e&&(N=R(c));o===n&&(a=c);o===t&&(x=R(c))}if(!N&&!a){N=r[0];U();return}$("#books li.book").toggleClass("active",!1);$("#books li.book[data-book='"+N+"']").toggleClass("active",!0);if(x!==""){B(!1);$("#searchbox").val(x)}if(a){C=a;T(C);$(".item").removeClass("shown");$("#items").isotope({filter:".shown"})}else{k('דו"ח טרכטנברג | המפקח: מעקב אחר ישום המלצות הועדה');C=null;T(null);l()}return _gaq.push(["_trackPageview","/"+i])};z=!1;B=function(e){e?$("#searchbox").val("סינון חופשי של ההמלצות"):z&&$("#searchbox").val("");z=e;return $("#searchbox").toggleClass("watermark",e)};u=function(e){var t,n;if(!e)return e;e=e.split(" ");if(e.length>1)t=e[0],n=e[1];else{t=e[0];n=null}t=t.split("/");t=""+t[2]+"/"+t[1]+"/"+t[0];return n?""+t+" "+n:t};a=function(e){var t,n,a,f,l,c,h,p,d,v,m,g,b,w,S,x,T,N,C,k,L,A,O,M,_,D,P;y=e;r={};o={};i={};s={};for(m=0,S=e.length;m<S;m++){l=e[m];f={};r[l.base.book]||(r[l.base.book]={});r[l.base.book][l.base.chapter]=!0;L=l.base.tags;for(g=0,x=L.length;g<x;g++){h=L[g];o[h]=1}((A=l.base.responsible_authority)!=null?A.main:void 0)!=null&&(i[l.base.responsible_authority.main]=1);O=l.base.timeline;for(b=0,T=O.length;b<T;b++){c=O[b];c.israeli_due_date=u(c.due_date)}s[l.base.subject]=1;t=[];v=[];M=l.updates;for(n in M){d=M[n];for(w=0,N=d.length;w<N;w++){p=d[w];p.user=n;p.israeli_update_time=u(p.update_time);n==="gov"?t.push(p):v.push(p);if(p.links){_=p.links;for(k=0,C=_.length;k<C;k++){a=_[k];f[a.url]=!0}}}}l.base.num_links=Object.keys(f).length;l.gov_updates=t;l.watch_updates=v;l.base.subscribers=(D=l.subscribers)!=null?D:0;((P=l.base.recommendation)!=null?P.length:void 0)>500?l.base.recommendation_shortened=l.base.recommendation.slice(0,501)+"&nbsp;"+("<a class='goto-detail' rel='"+l.slug+"' href='#'>")+"עוד..."+"</a>":l.base.recommendation_shortened=l.base.recommendation}o=Object.keys(o);i=Object.keys(i);s=Object.keys(s);r=Object.keys(r);if(localStorage){localStorage.data=JSON.stringify(e);localStorage.all_books=JSON.stringify(r);localStorage.all_tags=JSON.stringify(o);localStorage.all_people=JSON.stringify(i);localStorage.all_subjects=JSON.stringify(s)}return E()};d=!1;A=function(){var e,t,n,r,u,a,f,l,c,h;B(!0);$("#searchbox").change(function(){z?x="":x=$("#searchbox").val();return U()});$("#searchbox").focus(function(){return B(!1)});$("#searchbox").blur(function(){if($(this).val()==="")return B(!0)});$("#searchbar").submit(function(){return!1});t=[];for(u=0,l=o.length;u<l;u++){r=o[u];t.push({type:"tag",title:r})}for(a=0,c=i.length;a<c;a++){e=i[a];t.push({type:"person",title:e})}for(f=0,h=s.length;f<h;f++){n=s[f];t.push({type:"subject",title:n})}$("#searchbox").typeahead({source:t,items:20,matcher:function(e){return~e.title.indexOf(this.query)},valueof:function(e){return e.title},itemfrom:function(e){return{type:"subject",title:e}},selected:function(e){x=e;return U()},highlighter:function(e){var t;t=e.title.replace(new RegExp("("+this.query+")","ig"),function(e,t){return"<strong>"+t+"</strong>"});return e.type==="subject"?t:e.type==="tag"?"<span class='searchtag'><span>"+t+"</span></span>":e.type==="person"?"<span class='persontag'><span>"+t+"</span></span>":console.log(e.type+" "+e.title)}});return $("#clearsearch").click(function(){x="";B(!0);U();return!1})};S=function(e,t,n){var r;e=$("script[name="+e+"]").html();r=Mustache.to_html(e,t);return $(n).html(r)};f=function(e){var t,n,r,i,s,o;e=e.split("/");o=function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++){t=e[n];i.push(parseInt(t,10))}return i}(),s=o[0],r=o[1],n=o[2];i=function(e){switch(e){case 1:return"ינואר";case 2:return"פברואר";case 3:return"מרץ";case 4:return"אפריל";case 5:return"מאי";case 6:return"יוני";case 7:return"יולי";case 8:return"אוגוסט";case 9:return"ספטמבר";case 10:return"אוקטובר";case 11:return"נובמבר";case 12:return"דצמבר"}};return""+i(r)+" "+s};w=function(e){return e<10?"0"+e:e};q=function(e){switch(e){case"NEW":return"טרם התחיל";case"STUCK":return"תקוע";case"IN_PROGRESS":return"בתהליך";case"FIXED":return"יושם במלואו";case"WORKAROUND":return"יושם חלקית";case"IRRELEVANT":return"יישום ההמלצה כבר לא נדרש"}return""};v=function(e){switch(e){case"NEW":return!1;case"STUCK":return!1;case"IN_PROGRESS":return!0;case"FIXED":return!0;case"WORKAROUND":return!1;case"IRRELEVANT":return!0}return null};P=function(e,t){t==null&&(t=80);return $(e).each(function(){var e,n,r,i,s,o,u,a,l,c,h,p,d,m,g,y,b,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,I,R,U,z,W,X,V,J,K,Q,G,Y;m=$(this).find(".timeline-logic.horizontal").size()>0;U=new Date;U=""+U.getFullYear()+"/"+w(U.getMonth()+1)+"/"+w(U.getDate()+1);O=0;M=781200;$(this).find(".timeline-logic .timeline-point.today").attr("data-date",U);d=!1;$(this).find(".timeline-logic > ul > li").each(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;t=$(this).find(".timeline-point:first").attr("data-date");t=t.split(" ");t.length>1?f=t[1]:f="00:00:00";t=t[0].split("/");f=f.split(":");c=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++){e=t[n];i.push(parseInt(e,10))}return i}(),l=c[0],s=c[1],n=c[2];h=function(){var e,t,n;n=[];for(e=0,t=f.length;e<t;e++){a=f[e];n.push(parseInt(a,10))}return n}(),r=h[0],i=h[1],u=h[2];o=l*372+(s-1)*31+(n-1)+r/24+i/1440+u/86400;if(isNaN(o)||l===1970){o="xxx";d=!0}else{o>O&&(O=o);o<M&&(M=o-1)}$(this).attr("data-date-numeric",o);return $(this).find(".timeline-point").attr("data-date-numeric",o)});if(d){O+=180;$(this).find(".timeline-logic > ul > li[data-date-numeric='xxx']").attr("data-date-numeric",O);$(this).find(".timeline-logic > ul > li[data-date-numeric='xxx']").find(".timeline-point").attr("data-date-numeric",O)}$(this).find("img").each(function(){var e;e=$(this).attr("alt");if(e)return $(this).attr("src","/profile/"+F(e))});$(this).find(".update-feed > ul > li").tsort({attr:"data-date",order:"desc"});$(this).find(".timeline-logic > ul > li").tsort({attr:"data-date-numeric",order:"desc"});l=$(this).find(".timeline-logic > ul > li > .milestone:first").attr("data-date");l=f(l);$(this).find(".duedate > p").html(l);u=$(this).find(".date-bar");if(u){u.html("");b=Math.ceil(M/372).toFixed(0);C=Math.floor(O/372).toFixed(0);for(X=V=b;b<=C?V<=C:V>=C;X=b<=C?++V:--V)u.prepend("<li>"+X+"</li>");_=($(this).innerHeight()-t)/((O-M)/372);i=_-u.find("li:first").outerHeight();c=(1-M%372/372)*_;u.find("li").css("margin-bottom",i);u.find("li:last").css("margin-bottom",c+30)}x=0;E=5;m?P=$(this).innerWidth()-t:P=$(this).innerHeight()-t;n=P;$(this).find(".timeline-logic > ul > li .timeline-point").each(function(){return m?n=n-$(this).outerWidth()-E:n=n-$(this).outerHeight()-E});A=0;p="NEW";s=!1;o=null;k=!1;R=$(this).find(".timeline-logic > ul > li");W=parseInt($(this).find(".timeline-logic > ul > li .today").attr("data-date-numeric"));T=$(this).find(".timeline-logic > ul > li .gov-update:last").attr("data-date-numeric");T?T=parseInt(T):T=M;T&&W&&W-T>180&&(k=!0);e=1e3;N=e;z=e;h=e;for(g=J=Q=R.size()-1;Q<=0?J<=0:J>=0;g=Q<=0?++J:--J){a=$(R[g]);D=a.find(".timeline-point:first");L=a.find(".timeline-line:first");j=(G=D.attr("data-status"))!=null?G:p;if(D.hasClass("gov-update")){s=!1;p=j!=null?j:p;N=g;h===e&&(p==="FIXED"||p==="IRRELEVANT")&&(h=g);D.addClass("gov-"+p);v(p)?D.addClass("gov-status-good"):D.addClass("gov-status-bad")}S=!1;if(D.hasClass("today")){z=g;S=!0}if(D.hasClass("watch-update")){if(v(j)!==null){if(v(p)!==v(j)){s=!0;o=j}D.addClass("watch-"+j);v(j)?D.addClass("watch-status-good"):D.addClass("watch-status-bad")}else{D.addClass("no-review");D.removeClass("update")}N=g}if(z===e||S){a.find(".implementation-status").addClass("label-"+j);a.find(".implementation-status").html(q(j));L.addClass("status-"+p);s&&D.addClass("conflict")}}for(g=K=Y=R.size()-1;Y<=0?K<=0:K>=0;g=Y<=0?++K:--K){a=$(R[g]);L=a.find(".timeline-line:first");if(g<=z)L.addClass("future");else{L.addClass("past");g<=N&&L.addClass("unreported")}}$(this).find(".timeline-logic > ul > li").each(function(){var e,t,r,i;D=$(this).find(".timeline-point:first");L=$(this).find(".timeline-line:first");e=parseInt($(this).attr("data-date-numeric"));r=(O-e)/(O-M);m?i=D.outerWidth()+E:i=D.outerHeight()+E;t=n*(r-x)+i;if(m){$(this).css("width",t);$(this).css("left",A)}else{$(this).css("height",t);$(this).css("top",A)}x=r;return A+=t});$(this).find(".timeline-logic > ul > li:first > .timeline-line").remove();y=p;y!=="FIXED"&&y!=="IRRELEVANT"?k&&(y="STUCK"):k=!1;r=$(this).find(".buxa-header");if(s)r.addClass("conflict");else{r.removeClass("conflict");v(y)?r.addClass("good"):r.addClass("bad")}if(s){$(this).attr("data-implementation-status","CONFLICT");$(this).addClass("implementation-status-CONFLICT")}else $(this).attr("data-implementation-status",y);$(this).addClass("implementation-status-"+y);v(y)?$(this).addClass("implementation-status-good"):$(this).addClass("implementation-status-bad");I=function(e){switch(e){case"NEW":return"notstarted";case"STUCK":return"stuck";case"IN_PROGRESS":return"inprogress";case"FIXED":return"done";case"WORKAROUND":return"workaround";case"IRRELEVANT":return"done"}};B=I(y);k&&(B="late");r.before("<div class='stamp "+B+"'></div>");if(s){H=q(o);B=I(o);return r.before("<div class='stamp conflicting "+B+"'></div>")}})};_=function(){var e,t,n,r,i,s,o,u,a,f;a=$(".item.shown").size();u=$(".item.shown[data-implementation-status='STUCK']").size();o=$(".item.shown[data-implementation-status='NEW']").size();i=$(".item.shown[data-implementation-status='IN_PROGRESS']").size();n=$(".item.shown[data-implementation-status='FIXED']").size();f=$(".item.shown[data-implementation-status='WORKAROUND']").size();s=$(".item.shown[data-implementation-status='IRRELEVANT']").size();e=$(".item.shown[data-implementation-status='CONFLICT']").size();t={};a&&(t.total=a);u=o+f+u;u&&(t.stuck=u);r=n+s;r&&(t.implemented=r);i&&(t.in_progress=i);e&&(t.conflict=e);S("summary",t,"#summary");$("#summary .total").click(function(){I=null;l();return!1});$("#summary .stuck").click(function(){I=["STUCK","NEW","WORKAROUND"];l();return!1});$("#summary .implemented").click(function(){I=["FIXED","IRRELEVANT"];l();return!1});$("#summary .in_progress").click(function(){I=["IN_PROGRESS"];l();return!1});return $("#summary .conflict").click(function(){I=["CONFLICT"];l();return!1})};O=function(){$("#subscribe").modal({show:!1});$("#do_subscribe").click(function(){$("#subscribe_form").submit();return!1});return $("#subscribe_form").submit(function(){var e=this;$.post($(this).attr("action"),{email:$("#subscribe_email").val()},function(t){var n;$("#subscribe").modal("hide");n=$(e).attr("rel");return $(".watch[rel='"+n+"']").html(t)},"json");return!1})};M=function(e){return $(""+e+" .watch").click(function(){var e;e=$(this).attr("rel");$("#subscribe_email").attr("data-slug",e);$("#subscribe_form").attr("action","/subscribe/"+e);$("#subscribe_form").attr("rel",e);$("#subscribe").modal("show");return!1})};D=function(e){return $(e).click(function(){x=$(this).text();B(!1);$("#searchbox").val(x);$("#explanation").modal("hide");U();return!1})};L=function(){return $(".item .goto-detail").click(function(){var e,t,n,r,i;t=$(this).attr("rel");if(!t){i=$(this).parents();for(n=0,r=i.length;n<r;n++){e=i[n];t=$(e).attr("rel");if(t)break}}U(t);return!1})};H=function(e){return $(""+e+" .rel-tooltip").tooltip({placement:"bottom"})};E=function(){var e,t,n,i,s,o,u=this;n=p.findDeferral(arguments);if(d)return;d=!0;for(s=0,o=r.length;s<o;s++){e=r[s];$("#books").prepend("<li data-book='"+e+"' class='book'><a href='#'>"+e+"</a></li>")}S("item",{items:y},"#items");t=!0;(typeof localStorage!=="undefined"&&localStorage!==null?localStorage.explained:void 0)!=null&&(t=!1);$("#explanation .close").click(function(){typeof localStorage!="undefined"&&localStorage!==null&&(localStorage.explained=!0);$("#explanation").modal("hide");return!1});$("#show-explanation").click(function(){$("#explanation").modal("show");return!1});(function(e){i=new p.Deferrals(e,{parent:n,filename:"gov-watch.iced",funcname:"process_data"});setTimeout(i.defer({assign_fn:function(){return function(){return i.ret=arguments[0]}}(),lineno:706}),50);i._fulfill()})(function(){$.Isotope.prototype._positionAbs=function(e,t){return{right:e,top:t}};$("#items").isotope({itemSelector:".isotope-card",layoutMode:"masonry",transformsEnabled:!1,filter:".shown",getSortData:{followers:function(e){return-parseInt("0"+e.find(".watch").text())},original:function(e){return""+e.attr("data-chapter")+"/{e.attr('data-subchapter')}"},budget:function(e){return-parseInt("0"+e.attr("cost"),10)},comments:function(e){var t;t=-parseInt("0"+e.find(".commentcount").text(),10);return t}}});(function(e){i=new p.Deferrals(e,{parent:n,filename:"gov-watch.iced",funcname:"process_data"});setTimeout(i.defer({assign_fn:function(){return function(){return i.ret=arguments[0]}}(),lineno:728}),50);i._fulfill()})(function(){P(".item");$(".item").css("visibility","inherit");A();O();M(".item");D(".item .tags > ul > li, a[data-tag='true']");L();H(".item");$("#books li.book a").click(function(){N=$(this).html();U();return!1});$("#sort button").click(function(){var e;$("#sort button").removeClass("active");$(this).addClass("active");e=$(this).attr("value");$("#items").isotope("updateSortData",$(".isotope-card"));$("#items").isotope({sortBy:e});return!1});$("#explanation").modal({show:t});window.onhashchange=b;b();return g(".item")})})};T=function(e){var t,n,r,i,s,o,u,a=this;i=p.findDeferral(arguments);$("fb\\:comments").remove();$("fb\\:like").remove();if(!e){$("#single-item").html("");$("#summary-header").css("visibility","inherit");$("#orderstats").css("display","inherit");$("#sort button").removeClass("disabled");$("#searchbox").removeClass("disabled");$("#searchbox").attr("disabled",null);$("#clearsearch").removeClass("disabled");return W($("#clearsearch").attr("disabled",null))}$("#summary-header").css("visibility","hidden");$("#summary").html("");$("#orderstats").css("display","none");$("#sort button").addClass("disabled");$("#searchbox").addClass("disabled");$("#searchbox").attr("disabled","disabled");$("#clearsearch").addClass("disabled");$("#clearsearch").attr("disabled","disabled");for(o=0,u=y.length;o<u;o++){r=y[o];if(r.slug===e){t=S("single-item",r,"#single-item");k(r.base.book+": "+r.base.subject);n=h(e);$(".detail-view .fb").append("<fb:like href='"+n+"' send='true' width='700' show_faces='true' action='recommend' font='tahoma'></fb:like>");$(".detail-view .fb").append("<fb:comments href='"+n+"' num_posts='2' width='700'></fb:comments>");window.FB&&FB.XFBML.parse(t.get(0),function(){});break}}(function(e){s=new p.Deferrals(e,{parent:i,filename:"gov-watch.iced",funcname:"select_item"});setTimeout(s.defer({assign_fn:function(){return function(){return s.ret=arguments[0]}}(),lineno:796}),50);s._fulfill()})(function(){P(".detail-view",69);M(".detail-view");D(".detail-view .tags > ul > li");H(".detail-view");g(".detail-view");return W($("html, body").animate({scrollTop:0},0))})};g=function(e){$(""+e+" .commentcount").each(function(){var e,t,n,r,i,s=this;r=p.findDeferral(arguments);n=$(this).attr("rel");(function(e){i=new p.Deferrals(e,{parent:r,filename:"gov-watch.iced"});$.get("https://api.facebook.com/method/fql.query",{query:"SELECT url,commentsbox_count FROM link_stat WHERE url='"+h(n)+"'",format:"json"},i.defer({assign_fn:function(){return function(){return t=arguments[0]}}(),lineno:825}),"json");i._fulfill()})(function(){e=$(s).html();return $(s).html(t[0].commentsbox_count+e)})});if(e===".item")return $("#items").isotope("updateSortData",$(".item"))};l=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;n=RegExp(x,"ig");for(f=0,h=y.length;f<h;f++){r=y[f];s=r.slug;r=r.base;i=x==="";if(x!==""){v=[r.recommendation,r.subject,r.result_metric,r.title,r.chapter,r.subchapter,r.responsible_authority.main,r.responsible_authority.secondary];for(l=0,p=v.length;l<p;l++){a=v[l];a?t=a.indexOf(x)>=0:t=!1;i=i||t}m=r.tags;for(c=0,d=m.length;c<d;c++){u=m[c];u===x&&(i=!0)}}i=i&&(N===""||r.book===N)&&!C;$(".item[rel="+s+"]").toggleClass("shown",i)}_();if(I){e=[function(){var e,t,n;n=[];for(e=0,t=I.length;e<t;e++){o=I[e];n.push(".shown.implementation-status-"+o)}return n}()];e=e.join(",")}else e=".shown";e+=",.always-shown";$("#items").isotope({filter:e});return $("#items").isotope("reLayout")};m=function(){return $.get("/api",a,"json")};$(function(){var e,t,n,u,a=this;n=p.findDeferral(arguments);try{(function(e){u=new p.Deferrals(e,{parent:n,filename:"gov-watch.iced"});$.get("/api/version",u.defer({assign_fn:function(){return function(){return t=arguments[0]}}(),lineno:886}),"json");u._fulfill()})(function(){e=localStorage.version;localStorage.version=JSON.stringify(t);if(e&&t!==JSON.parse(e)){y=JSON.parse(localStorage.data);r=JSON.parse(localStorage.all_books);o=JSON.parse(localStorage.all_tags);i=JSON.parse(localStorage.all_people);s=JSON.parse(localStorage.all_subjects);return E()}return m()})}catch(f){return m()}})}).call(this);